(self.webpackChunkblog=self.webpackChunkblog||[]).push([[546],{11546:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ee}});var r={};n.r(r),n.d(r,{getList:function(){return j},lock:function(){return P},remove:function(){return I},save:function(){return x},unlock:function(){return D}});n(92222),n(26541),n(57327),n(26699),n(66992),n(21249),n(5212),n(68309),n(41539),n(88674),n(32023),n(78783),n(73210),n(33948),n(35666);var a=n(63804),o=n.n(a),l=n(15862),i=n(48086),u=n(60331),c=n(71577),s=n(51752),f=n(71230),m=n(15746),d=n(62529),y=n(69713),v=n(61606),p=n(90753),b=n(49101),g=n(59879),E=n(73171),h=n(58988),k=n(2603),O=n(59271),S=n(12470),w=n.n(S),Z=n(85344),C=n(94036);function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,Z.v_)(C.eQ.ADMIN_LIST,e)}function x(e){return(0,Z.v_)(C.eQ.ADMIN_SAVE,e)}function I(e){return(0,Z.v_)(C.eQ.ADMIN_DELETE,e)}function P(e){return(0,Z.v_)(C.eQ.ADMIN_LOCK,e)}function D(e){return(0,Z.v_)(C.eQ.ADMIN_UNLOCK,e)}var A=n(59781),L=(n(82772),n(47941),n(82482)),M=n(3785),_=n(71113);function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){V(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(r=(l=i.next()).done)&&(n.push(l.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Y(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var F={labelCol:{span:5},wrapperCol:{span:17}},Q=(0,a.memo)((function(e){var t=e.type,n=e.initialValues,r=e.visible,l=e.allSortList,u=e.onSave,c=e.onToggleEditorialPanel,s=Y(e,["type","initialValues","visible","allSortList","onSave","onToggleEditorialPanel"]),f=K(L.Z.useForm(),1)[0],m=(0,a.useCallback)((function(){f.resetFields(),c()}),[f,c]),d=(0,a.useCallback)((function(){f.validateFields().then((function(e){var t=e,r=t.sort,a=Y(t,["sort"]);r&&(a.sortId=r.key),u(T({id:null==n?void 0:n.id},a),(function(){f.resetFields(),c()}))})).catch((function(e){i.ZP.error(e.message)}))}),[f,n,u,c]),y=(0,a.useMemo)((function(){var e=n||{},t=e.name,r=e.isEnable,a=void 0===r?1:r,o=e.sort;return T(T({},{isEnable:a,name:t}),{},{sort:o?{label:o.name,key:o.id}:void 0})}),[n]);return o().createElement(M.Z,z({destroyOnClose:!0,title:null!=n&&n.id?"更新":"添加",visible:r,onOk:d,onCancel:m,maskClosable:!1},s),o().createElement(L.Z,z({},F,{form:f,initialValues:y}),o().createElement(L.Z.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称!"}]},o().createElement(v.Z,null)),"cate"===t&&o().createElement(L.Z.Item,{label:"所属",name:"sort",rules:[{required:!0,message:"请选择状态!"}]},o().createElement(_.Z,{labelInValue:!0},l.map((function(e){return o().createElement(_.Z.Option,{key:e.id,value:e.id},e.name)})))),o().createElement(L.Z.Item,{label:"状态",name:"isEnable",rules:[{required:!0,message:"请选择状态!"}],style:{marginBottom:0}},o().createElement(_.Z,null,o().createElement(_.Z.Option,{value:1},"可用"),o().createElement(_.Z.Option,{value:0},"不可用")))))}));function B(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||W(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t,n,r,a,o,l){try{var i=e[o](l),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function q(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function l(e){U(o,r,a,l,i,"next",e)}function i(e){U(o,r,a,l,i,"throw",e)}l(void 0)}))}}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){J(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(r=(l=i.next()).done)&&(n.push(l.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}(e,t)||W(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){if(e){if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ee=(0,a.memo)((function(){var e=(0,a.useRef)(null),t=G((0,a.useState)(0),2),n=t[0],S=t[1],Z=G((0,a.useState)([]),2),C=Z[0],I=Z[1],P=G((0,a.useState)({current:1,pageSize:10}),2),D=P[0],L=P[1],M=G((0,a.useState)("sort"),2),_=M[0],z=M[1],N=G((0,a.useState)(!1),2),T=N[0],V=N[1],K=G((0,a.useState)([]),2),R=K[0],Y=K[1],F=G((0,a.useState)([]),2),U=F[0],$=F[1],J=G((0,a.useState)({}),2),W=J[0],X=J[1],ee=G((0,a.useState)({}),2),te=ee[0],ne=ee[1],re=G((0,a.useState)(!1),2),ae=re[0],oe=re[1],le=G((0,a.useState)("sort"),2),ie=le[0],ue=le[1],ce=G((0,a.useState)(null),2),se=ce[0],fe=ce[1],me=(0,a.useCallback)((function(){var t,n;X({}),ne({}),null===(t=e.current)||void 0===t||null===(n=t.setValue)||void 0===n||n.call(t,""),L((function(e){return H(H({},e),{},{current:1})}))}),[]),de=(0,a.useCallback)((function(e){L((function(e){return H(H({},e),{},{current:1})})),X((function(t){return H(H({},t),{},{name:e.trim()})}))}),[]),ye=(0,a.useCallback)(q(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.I.getList({index:1,size:999});case 2:n=e.sent,r=G(n,1),a=r[0],$((null==a||null===(t=a.data)||void 0===t?void 0:t.list)||[]);case 6:case"end":return e.stop()}}),e)}))),[]),ve=(0,a.useCallback)((function(e,t){var n=[];n=C.length===e.length?t:C.length<e.length?[].concat(B(C.filter((function(e){return t.every((function(t){return e.id!==t.id}))}))),B(t)):C.filter((function(t){return e.some((function(e){return e===t.id}))})),I(n)}),[C]),pe=(0,a.useCallback)((function(e,t,n){var r;L({current:e.current,pageSize:e.pageSize});var a=n,o=a.columnKey,l=a.order,i=l?{name:o,by:"descend"===l?"DESC":"ASC"}:{},u=null==t||null===(r=t.isEnable)||void 0===r?void 0:r[0],c=(null==t?void 0:t.sort)||[];ne(t),X((function(e){return H(H({},e),{},{orderBy:i,isEnable:u,sortIdsArr:c})}))}),[]),be=(0,a.useCallback)((function(t){var n,r;L((function(e){return H(H({},e),{},{current:1})})),Y([]),I([]),ne({}),X({}),z(t),ue(t),null===(n=e.current)||void 0===n||null===(r=n.setValue)||void 0===r||r.call(n,"")}),[]),ge=(0,a.useCallback)(function(){var e=q(regeneratorRuntime.mark((function e(t){var n,a,o,l,u,c,s,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=f.length>1&&void 0!==f[1]?f[1]:_,a=f.length>2?f[2]:void 0,o=(a?[a]:C).map((function(e){return{id:e.id,name:e.name}})),l="sort"===n?A.I:r,e.t0=t,e.next="remove"===e.t0?7:"lock"===e.t0?9:"unlock"===e.t0?11:13;break;case 7:return u=l.remove,e.abrupt("break",14);case 9:return u=l.lock,e.abrupt("break",14);case 11:return u=l.unlock,e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:return e.next=16,u({items:o});case 16:if(c=e.sent,s=G(c,2),!s[1]){e.next=22;break}return i.ZP.error("操作失败"),e.abrupt("return");case 22:i.ZP.success("操作成功"),I([]),L((function(e){return H(H({},e),{},{current:1})})),"sort"===n&&ye();case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[C,_,ye]),Ee=(0,a.useCallback)((function(e,t){fe(t),ue(e?"cate":_),oe((function(e){return!e}))}),[_]),he=(0,a.useCallback)((function(e,t){i.ZP.loading({content:"正在提交...",key:"saveData",duration:0}),Promise.race("sort"===ie?[A.I.save(e)]:[x(e)]).then((function(e){var n=G(e,2)[1];if(n)throw n;L((function(e){return H(H({},e),{},{current:1})})),i.ZP.success({content:"操作成功",key:"saveData"}),t&&t(),"sort"===ie&&ye()})).catch((function(e){i.ZP.error({content:e.message||"提交失败",key:"saveData"})}))}),[ie,ye]),ke=(0,a.useCallback)((function(e,t){var n;return[{title:"名称",dataIndex:"name",key:"name",sorter:!0},"cate"===e&&!(null!=t&&null!==(n=t.includes)&&void 0!==n&&n.call(t,"sort"))&&{title:"所属",dataIndex:"sort",key:"sort",sorter:!0,filters:U.map((function(e){return{text:e.name,value:e.id}})),filteredValue:(null==te?void 0:te.sort)||[],render:function(e){return null==e?void 0:e.name}},{title:"创建时间",dataIndex:"createDate",key:"createDate",sorter:!0,render:function(e){return w()(new Date(e)).format("YYYY-MM-DD")}},{title:"修改时间",dataIndex:"updateDate",key:"updateDate",sorter:!0,render:function(e){return w()(new Date(e)).format("YYYY-MM-DD")}},{title:"状态",dataIndex:"isEnable",key:"isEnable",sorter:!0,filters:[{text:"不可用",value:0},{text:"可用",value:1}],filterMultiple:!1,filteredValue:(null==te?void 0:te.isEnable)||[],render:function(e){return o().createElement(u.Z,{color:1===e?"blue":"gray"},1===e?"可用":"不可用")}},{title:"操作",key:"action",render:function(t){return o().createElement(o().Fragment,null,o().createElement(c.Z,{size:"small",type:"primary",onClick:function(){Ee(e!==_,t)}},"编辑"),o().createElement(c.Z,{size:"small",danger:!0,type:"primary",onClick:function(){ge("remove",e,t)},style:{marginLeft:10}},"删除"),o().createElement(c.Z,{size:"small",type:"primary",onClick:function(){ge(t.isEnable?"lock":"unlock",e,t)},style:{marginLeft:10}},t.isEnable?"禁用":"启用"))}}].filter(Boolean)}),[_,U,te,Ee,ge]);(0,a.useEffect)((function(){V(!0);var e={index:D.current,size:D.pageSize,conditionQuery:W};Promise.race("sort"===_?[A.I.getList(e)]:[j(e)]).then((function(e){var t=G(e,2),n=t[0],r=t[1];if(r)throw r;V(!1),S(n.data.total),Y(n.data.list)})).catch((function(e){i.ZP.error(e.message||"获取分类失败")}))}),[_,W,D]),(0,a.useEffect)((function(){ye()}),[ye]);var Oe=(0,a.useMemo)((function(){return o().createElement(s.Z,{activeKey:_,onChange:be},o().createElement(s.Z.TabPane,{tab:"一级分类",key:"sort"}),o().createElement(s.Z.TabPane,{tab:"二级分类",key:"cate"}))}),[_,be]),Se=(0,a.useMemo)((function(){return o().createElement(f.Z,{align:"middle",style:{marginBottom:15}},o().createElement(m.Z,{xs:12,sm:13,md:15,lg:16,xl:17},o().createElement(c.Z,{icon:o().createElement(b.Z,null),type:"primary",size:"small",onClick:function(){Ee()}},"新增"),"sort"===_&&o().createElement(c.Z,{icon:o().createElement(b.Z,null),type:"primary",size:"small",style:{marginLeft:10},onClick:function(){Ee(!0)}},"新增子分类"),C.length>0&&o().createElement(o().Fragment,null,o().createElement(d.Z,{count:C.length,title:"已选项数"},o().createElement(c.Z,{icon:o().createElement(g.Z,null),type:"primary",size:"small",onClick:function(){I([])},style:{marginLeft:10}},"清空")),o().createElement(c.Z,{icon:o().createElement(E.Z,null),type:"primary",danger:!0,size:"small",onClick:function(){ge("remove")},style:{marginLeft:10}},"删除"),o().createElement(c.Z,{icon:o().createElement(h.Z,null),type:"primary",size:"small",onClick:function(){ge("unlock")},style:{marginLeft:10}},"启用"),o().createElement(c.Z,{icon:o().createElement(k.Z,null),type:"primary",size:"small",onClick:function(){ge("lock")},style:{marginLeft:10}},"禁用"))),o().createElement(m.Z,{xs:2,sm:2,md:1,lg:1,xl:1},o().createElement(y.Z,{title:"默认展示"},o().createElement(c.Z,{type:"primary",icon:o().createElement(O.Z,null),shape:"circle",size:"small",onClick:me}))),o().createElement(m.Z,{xs:10,sm:9,md:8,lg:7,xl:6},o().createElement(v.Z.Search,{ref:e,placeholder:"Enter something",onSearch:de,enterButton:!0,allowClear:!0})))}),[_,C,Ee,ge,de,me]),we=(0,a.useMemo)((function(){return o().createElement(p.Z,{columns:ke(_),rowKey:"id",onChange:pe,rowSelection:{selectedRowKeys:C.map((function(e){return e.id})),onChange:ve},loading:T,dataSource:R,pagination:H({showQuickJumper:!0,showSizeChanger:!0,total:n},D),expandable:"sort"===_&&{expandedRowRender:function(e){var t,n,r=null==e||null===(t=e.categories)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.call(t,(function(t){return H(H({},t),{},{sort:H(H({},e),{},{categories:void 0})})}));return o().createElement(p.Z,{columns:ke("cate",["sort"]),rowKey:"id",loading:T,dataSource:r||[],pagination:!1,showHeader:!1})}}})}),[_,n,C,T,R,D,ke,pe,ve]),Ze=(0,a.useMemo)((function(){return ae?o().createElement(Q,{type:ie,visible:ae,initialValues:se,allSortList:U.filter((function(e){return Boolean(e.isEnable)})),onToggleEditorialPanel:Ee,onSave:he}):null}),[ae,ie,se,U,Ee,he]);return o().createElement(l.F_,null,Oe,Se,we,Ze)}))},59781:function(e,t,n){"use strict";n.d(t,{I:function(){return r}});var r={};n.r(r),n.d(r,{getList:function(){return l},lock:function(){return c},remove:function(){return u},save:function(){return i},unlock:function(){return s}});var a=n(85344),o=n(94036);function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.v_)(o.xx.ADMIN_LIST,e)}function i(e){return(0,a.v_)(o.xx.ADMIN_SAVE,e)}function u(e){return(0,a.v_)(o.xx.ADMIN_DELETE,e)}function c(e){return(0,a.v_)(o.xx.ADMIN_LOCK,e)}function s(e){return(0,a.v_)(o.xx.ADMIN_UNLOCK,e)}}}]);
//# sourceMappingURL=546.js.map